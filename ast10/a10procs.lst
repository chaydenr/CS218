     1                                 %line 1+1 a10procs.asm
     2                                 
     3                                 
     4                                 
     5                                 
     6                                 
     7                                 
     8                                 
     9                                 
    10                                 
    11                                 
    12                                 
    13                                 
    14                                 
    15                                 
    16                                 
    17                                 
    18                                 
    19                                 
    20                                 
    21                                 
    22                                 
    23                                 
    24                                 [section .data]
    25                                 
    26                                 
    27                                 
    28                                 
    29                                 TRUE equ 1
    30                                 FALSE equ 0
    31                                 
    32                                 SUCCESS equ 0
    33                                 NOSUCCESS equ 1
    34                                 
    35                                 STDIN equ 0
    36                                 STDOUT equ 1
    37                                 STDERR equ 2
    38                                 
    39                                 SYS_read equ 0
    40                                 SYS_write equ 1
    41                                 SYS_open equ 2
    42                                 SYS_close equ 3
    43                                 SYS_fork equ 57
    44                                 SYS_exit equ 60
    45                                 SYS_creat equ 85
    46                                 SYS_time equ 201
    47                                 
    48                                 LF equ 10
    49                                 SPACE equ " "
    50                                 NULL equ 0
    51                                 ESC equ 27
    52                                 
    53                                 
    54                                 
    55                                 
    56                                 GL_COLOR_BUFFER_BIT equ 16384
    57                                 GL_POINTS equ 0
    58                                 GL_POLYGON equ 9
    59                                 GL_PROJECTION equ 5889
    60                                 
    61                                 GLUT_RGB equ 0
    62                                 GLUT_SINGLE equ 0
    63                                 
    64                                 
    65                                 
    66                                 
    67                                 SPD_MIN equ 1
    68                                 SPD_MAX equ 50
    69                                 
    70                                 CLR_MIN equ 0
    71                                 CLR_MAX equ 0xFFFFFF
    72                                 
    73                                 SIZ_MIN equ 100
    74                                 SIZ_MAX equ 2000
    75                                 
    76                                 
    77                                 
    78                                 
    79                                 STR_LENGTH equ 12
    80                                 
    81 00000000 55736167653A202E2F-    errUsage db "Usage: ./wheels -sp <septNumber> -cl <septNumber> "
    82 00000000 776865656C73202D73-
    83 00000000 70203C736570744E75-
    84 00000000 6D6265723E202D636C-
    85 00000000 203C736570744E756D-
    86 00000000 6265723E20         
    87 00000032 2D737A203C73657074-     db "-sz <septNumber>"
    88 00000032 4E756D6265723E     
    89 00000042 0A00                    db LF, NULL
    90 00000044 4572726F722C20696E-    errBadCL db "Error, invalid or incomplete command line argument."
    91 00000044 76616C6964206F7220-
    92 00000044 696E636F6D706C6574-
    93 00000044 6520636F6D6D616E64-
    94 00000044 206C696E6520617267-
    95 00000044 756D656E742E       
    96 00000077 0A00                    db LF, NULL
    97                                 
    98 00000079 4572726F722C207370-    errSpdSpec db "Error, speed specifier incorrect."
    99 00000079 656564207370656369-
   100 00000079 6669657220696E636F-
   101 00000079 72726563742E       
   102 0000009A 0A00                    db LF, NULL
   103 0000009C 4572726F722C207370-    errSpdValue db "Error, speed value must be between 1 and 101(7)."
   104 0000009C 6565642076616C7565-
   105 0000009C 206D75737420626520-
   106 0000009C 6265747765656E2031-
   107 0000009C 20616E642031303128-
   108 0000009C 37292E             
   109 000000CC 0A00                    db LF, NULL
   110                                 
   111 000000CE 4572726F722C20636F-    errClrSpec db "Error, color specifier incorrect."
   112 000000CE 6C6F72207370656369-
   113 000000CE 6669657220696E636F-
   114 000000CE 72726563742E       
   115 000000EF 0A00                    db LF, NULL
   116 000000F1 4572726F722C20636F-    errClrValue db "Error, color value must be between 0 and 262414110(7)."
   117 000000F1 6C6F722076616C7565-
   118 000000F1 206D75737420626520-
   119 000000F1 6265747765656E2030-
   120 000000F1 20616E642032363234-
   121 000000F1 31343131302837292E 
   122 00000127 0A00                    db LF, NULL
   123                                 
   124 00000129 4572726F722C207369-    errSizSpec db "Error, size specifier incorrect."
   125 00000129 7A6520737065636966-
   126 00000129 69657220696E636F72-
   127 00000129 726563742E         
   128 00000149 0A00                    db LF, NULL
   129 0000014B 4572726F722C207369-    errSizValue db "Error, size value must be between 202(7) and 5555(7)."
   130 0000014B 7A652076616C756520-
   131 0000014B 6D7573742062652062-
   132 0000014B 65747765656E203230-
   133 0000014B 3228372920616E6420-
   134 0000014B 353535352837292E   
   135 00000180 0A00                    db LF, NULL
   136                                 
   137                                 
   138                                 
   139                                 
   140 00000182 0000000000000000       t dq 0.0
   141 0000018A 0000000000000000       s dq 0.0
   142 00000192 FCA9F1D24D62503F       tStep dq 0.001
   143 0000019A 0000000000000000       sStep dq 0.0
   144 000001A2 0000000000000000       x dq 0
   145 000001AA 0000000000000000       y dq 0
   146 000001B2 00000000004CBD40       scale dq 7500.0
   147                                 
   148 000001BA 0000000000000000       fltZero dq 0.0
   149 000001C2 000000000000F03F       fltOne dq 1.0
   150 000001CA 0000000000000040       fltTwo dq 2.0
   151 000001D2 0000000000000840       fltThree dq 3.0
   152 000001DA 0000000000001040       fltFour dq 4.0
   153 000001E2 0000000000001840       fltSix dq 6.0
   154 000001EA 0000000000000000       fltTwoPiS dq 0.0
   155                                 
   156 000001F2 F4D64354FB210940       pi dq 3.14159265358
   157                                 
   158 000001FA 0000000000000000       fltTmp1 dq 0.0
   159 00000202 0000000000000000       fltTmp2 dq 0.0
   160                                 
   161 0000020A 00000000               red dd 0
   162 0000020E 00000000               green dd 0
   163 00000212 00000000               blue dd 0
   164                                 
   165                                 
   166                                 
   167                                 
   168                                 [section .text]
   169                                 
   170                                 
   171                                 
   172                                 
   173                                 [extern glutInit]
   174                                 %line 137+0 a10procs.asm
   175                                 [extern glutInitDisplayMode]
   176                                 [extern glutInitWindowSize]
   177                                 [extern glutInitWindowPosition]
   178                                 %line 138+1 a10procs.asm
   179                                 [extern glutCreateWindow]
   180                                 %line 138+0 a10procs.asm
   181                                 [extern glutMainLoop]
   182                                 %line 139+1 a10procs.asm
   183                                 [extern glutDisplayFunc]
   184                                 %line 139+0 a10procs.asm
   185                                 [extern glutIdleFunc]
   186                                 [extern glutReshapeFunc]
   187                                 [extern glutKeyboardFunc]
   188                                 %line 140+1 a10procs.asm
   189                                 [extern glutSwapBuffers]
   190                                 %line 140+0 a10procs.asm
   191                                 [extern gluPerspective]
   192                                 [extern glutPostRedisplay]
   193                                 %line 141+1 a10procs.asm
   194                                 [extern glClearColor]
   195                                 %line 141+0 a10procs.asm
   196                                 [extern glClearDepth]
   197                                 [extern glDepthFunc]
   198                                 [extern glEnable]
   199                                 [extern glShadeModel]
   200                                 %line 142+1 a10procs.asm
   201                                 [extern glClear]
   202                                 %line 142+0 a10procs.asm
   203                                 [extern glLoadIdentity]
   204                                 [extern glMatrixMode]
   205                                 [extern glViewport]
   206                                 %line 143+1 a10procs.asm
   207                                 [extern glTranslatef]
   208                                 %line 143+0 a10procs.asm
   209                                 [extern glRotatef]
   210                                 [extern glBegin]
   211                                 [extern glEnd]
   212                                 [extern glVertex3f]
   213                                 [extern glColor3f]
   214                                 %line 144+1 a10procs.asm
   215                                 [extern glVertex2f]
   216                                 %line 144+0 a10procs.asm
   217                                 [extern glVertex2i]
   218                                 [extern glColor3ub]
   219                                 [extern glOrtho]
   220                                 [extern glFlush]
   221                                 [extern glVertex2d]
   222                                 %line 145+1 a10procs.asm
   223                                 
   224                                 [extern cos]
   225                                 %line 146+0 a10procs.asm
   226                                 [extern sin]
   227                                 %line 147+1 a10procs.asm
   228                                 
   229                                 
   230                                 
   231                                 
   232                                 
   233                                 
   234                                 
   235                                 
   236                                 
   237                                 
   238                                 
   239                                 
   240                                 
   241                                 
   242                                 
   243                                 
   244                                 
   245                                 
   246                                 
   247                                 
   248                                 
   249                                 
   250                                 
   251                                 [global getParams]
   252                                 getParams:
   253 00000000 55                     push rbp
   254 00000001 4889E5                 mov rbp, rsp
   255 00000004 4883EC1C               sub rsp, 28
   256                                 
   257 00000008 4150                   push r8
   258 0000000A 4151                   push r9
   259 0000000C 4154                   push r12
   260 0000000E 4155                   push r13
   261 00000010 4156                   push r14
   262                                 
   263 00000012 4989FC                 mov r12, rdi
   264 00000015 49C7C500000000         mov r13, 0
   265 0000001C 4989F6                 mov r14, rsi
   266                                 
   267 0000001F 57                     push rdi
   268 00000020 56                     push rsi
   269                                 
   270                                 
   271 00000021 4983FC01               cmp r12, 1
   272 00000025 746D                   je errUsage_
   273                                 
   274                                 
   275 00000027 4983FC07               cmp r12, 7
   276 0000002B 7570                   jne errBadCL_
   277                                 
   278                                 
   279                                 
   280 0000002D 4D8B6E08               mov r13, qword[r14 + 8]
   281                                 
   282 00000031 41807D002D             cmp byte[r13], '-'
   283 00000036 756E                   jne errSpdSpec_
   284 00000038 41807D0173             cmp byte[r13 + 1], 's'
   285 0000003D 7567                   jne errSpdSpec_
   286 0000003F 41807D0270             cmp byte[r13 + 2], 'p'
   287 00000044 7560                   jne errSpdSpec_
   288 00000046 41807D0300             cmp byte[r13 + 3], NULL
   289 0000004B 7559                   jne errSpdSpec_
   290                                 
   291                                 
   292                                 
   293                                 
   294                                 
   295 0000004D 4D8B6E18               mov r13, qword[r14 + 24]
   296                                 
   297 00000051 41807D002D             cmp byte[r13], '-'
   298 00000056 7560                   jne errClrSpec_
   299 00000058 41807D0163             cmp byte[r13 + 1], 'c'
   300 0000005D 7559                   jne errClrSpec_
   301 0000005F 41807D026C             cmp byte[r13 + 2], 'l'
   302 00000064 7552                   jne errClrSpec_
   303 00000066 41807D0300             cmp byte[r13 + 3], NULL
   304 0000006B 754B                   jne errClrSpec_
   305                                 
   306                                 
   307                                 
   308                                 
   309                                 
   310                                 
   311 0000006D 4D8B6E28               mov r13, qword[r14 + 40]
   312                                 
   313 00000071 41807D002D             cmp byte[r13], '-'
   314 00000076 7549                   jne errSizSpec_
   315 00000078 41807D0173             cmp byte[r13 + 1], 's'
   316 0000007D 7542                   jne errSizSpec_
   317 0000007F 41807D027A             cmp byte[r13 + 2], 'z'
   318 00000084 753B                   jne errSizSpec_
   319 00000086 41807D0300             cmp byte[r13 + 3], NULL
   320 0000008B 7534                   jne errSizSpec_
   321                                 
   322 0000008D 48C7C001000000         mov rax, TRUE
   323 00000094 EB40                   jmp doneSuccess
   324                                 
   325                                 
   326                                 errUsage_:
   327 00000096 48C7C7[00000000]       mov rdi, errUsage
   328 0000009D EB2B                   jmp doneError
   329                                 
   330                                 errBadCL_:
   331 0000009F 48C7C7[00000000]       mov rdi, errBadCL
   332 000000A6 EB22                   jmp doneError
   333                                 
   334                                 errSpdSpec_:
   335 000000A8 48C7C7[00000000]       mov rdi, errSpdSpec
   336 000000AF EB19                   jmp doneError
   337                                 
   338                                 errSpdValue_:
   339 000000B1 48C7C7[00000000]       mov rdi, errSpdValue
   340 000000B8 EB10                   jmp doneError
   341                                 
   342                                 errClrSpec_:
   343 000000BA 48C7C7[00000000]       mov rdi, errClrSpec
   344 000000C1 EB07                   jmp doneError
   345                                 
   346                                 errClrValue_:
   347                                 
   348                                 
   349                                 errSizSpec_:
   350 000000C3 48C7C7[00000000]       mov rdi, errSizSpec
   351 000000CA EBFE                   jmp doneError
   352                                 
   353                                 doneError:
   354 000000CC E882000000             call printString
   355 000000D1 48C7C000000000         mov rax, FALSE
   356                                 
   357                                 doneSuccess:
   358 000000D8 5E                     pop rsi
   359 000000D9 5F                     pop rdi
   360 000000DA 415E                   pop r14
   361 000000DC 415D                   pop r13
   362 000000DE 415C                   pop r12
   363 000000E0 4159                   pop r9
   364 000000E2 4158                   pop r8
   365                                 
   366 000000E4 4889EC                 mov rsp, rbp
   367 000000E7 5D                     pop rbp
   368                                 
   369 000000E8 C3                     ret
   370                                 
   371                                 
   372                                 
   373                                 
   374                                 
   375                                 
   376                                 
   377                                 
   378                                 
   379                                 
   380                                 
   381                                 
   382                                 
   383                                 
   384                                 
   385                                 [common speed 1:4]
   386                                 [common color 1:4]
   387                                 [common size 1:4]
   388                                 
   389                                 [global drawWheels]
   390                                 drawWheels:
   391 000000E9 55                      push rbp
   392                                 
   393                                 
   394                                 
   395                                 
   396                                 
   397                                 
   398                                 
   399                                 
   400                                 
   401                                 
   402                                 
   403                                 
   404                                 
   405 000000EA 48C7C700400000          mov rdi, GL_COLOR_BUFFER_BIT
   406 000000F1 E8(F6FFFFFF)            call glClear
   407                                 
   408                                 
   409 000000F6 48C7C700000000          mov rdi, GL_POINTS
   410 000000FD E8(F6FFFFFF)            call glBegin
   411                                 
   412                                 
   413                                 
   414                                 
   415                                 
   416                                 
   417                                 
   418                                 
   419                                 
   420                                 
   421                                 
   422                                 
   423                                 
   424                                 
   425                                 
   426                                 
   427                                 
   428                                 
   429                                 
   430 00000102 E8(F6FFFFFF)            call glEnd
   431 00000107 E8(F6FFFFFF)            call glFlush
   432                                 
   433                                 
   434                                 
   435                                 
   436                                 
   437                                 
   438 0000010C F20F100425[00000000]      movsd xmm0, qword [s]
   439 00000115 F20F580425[00000000]      addsd xmm0, qword [sStep]
   440 0000011E F20F110425[00000000]      movsd qword [s], xmm0
   441                                 
   442 00000127 F20F100425[00000000]      movsd xmm0, qword [s]
   443 00000130 F20F100C25[00000000]      movsd xmm1, qword [fltOne]
   444 00000139 660F2EC1                ucomisd xmm0, xmm1
   445 0000013D 7610                    jbe resetDone
   446                                 
   447 0000013F F20F100425[00000000]      movsd xmm0, qword [fltZero]
   448 00000148 F20F110425[00000000]      movsd qword [sStep], xmm0
   449                                 resetDone:
   450                                 
   451 00000151 E8(F6FFFFFF)            call glutPostRedisplay
   452                                 
   453                                 
   454                                 
   455 00000156 5D                      pop rbp
   456 00000157 C3                      ret
   457                                 
   458                                 
   459                                 
   460                                 
   461                                 
   462                                 
   463                                 
   464                                 
   465                                 
   466                                 
   467                                 
   468                                 
   469                                 
   470                                 [global printString]
   471                                 printString:
   472 00000158 53                      push rbx
   473                                 
   474                                 
   475                                 
   476                                 
   477 00000159 4889FB                  mov rbx, rdi
   478 0000015C 48C7C200000000          mov rdx, 0
   479                                 strCountLoop:
   480 00000163 803B00                  cmp byte [rbx], NULL
   481 00000166 7406                    je strCountDone
   482 00000168 48FFC3                  inc rbx
   483 0000016B 48FFC2                  inc rdx
   484 0000016E EBF1                    jmp strCountLoop
   485                                 strCountDone:
   486                                 
   487 00000170 4883FA00                cmp rdx, 0
   488 00000174 7411                    je prtDone
   489                                 
   490                                 
   491                                 
   492                                 
   493 00000176 48C7C001000000          mov rax, SYS_write
   494 0000017D 4889FE                  mov rsi, rdi
   495 00000180 48C7C701000000          mov rdi, STDOUT
   496                                 
   497 00000187 0F05                    syscall
   498                                 
   499                                 
   500                                 
   501                                 
   502                                 prtDone:
   503 00000189 5B                      pop rbx
   504 0000018A C3                      ret
   505                                 
   506                                 
   507                                 
