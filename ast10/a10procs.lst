     1                                 %line 1+1 a10procs.asm
     2                                 
     3                                 
     4                                 
     5                                 
     6                                 
     7                                 
     8                                 
     9                                 
    10                                 
    11                                 
    12                                 
    13                                 
    14                                 
    15                                 
    16                                 
    17                                 
    18                                 
    19                                 
    20                                 
    21                                 
    22                                 
    23                                 
    24                                 [section .data]
    25                                 
    26                                 
    27                                 
    28                                 
    29                                 TRUE equ 1
    30                                 FALSE equ 0
    31                                 
    32                                 SUCCESS equ 0
    33                                 NOSUCCESS equ 1
    34                                 
    35                                 STDIN equ 0
    36                                 STDOUT equ 1
    37                                 STDERR equ 2
    38                                 
    39                                 SYS_read equ 0
    40                                 SYS_write equ 1
    41                                 SYS_open equ 2
    42                                 SYS_close equ 3
    43                                 SYS_fork equ 57
    44                                 SYS_exit equ 60
    45                                 SYS_creat equ 85
    46                                 SYS_time equ 201
    47                                 
    48                                 LF equ 10
    49                                 SPACE equ " "
    50                                 NULL equ 0
    51                                 ESC equ 27
    52                                 
    53                                 
    54                                 
    55                                 
    56                                 GL_COLOR_BUFFER_BIT equ 16384
    57                                 GL_POINTS equ 0
    58                                 GL_POLYGON equ 9
    59                                 GL_PROJECTION equ 5889
    60                                 
    61                                 GLUT_RGB equ 0
    62                                 GLUT_SINGLE equ 0
    63                                 
    64                                 
    65                                 
    66                                 
    67                                 SPD_MIN equ 1
    68                                 SPD_MAX equ 50
    69                                 
    70                                 CLR_MIN equ 0
    71                                 CLR_MAX equ 0xFFFFFF
    72                                 
    73                                 SIZ_MIN equ 100
    74                                 SIZ_MAX equ 2000
    75                                 
    76                                 
    77                                 
    78                                 
    79                                 STR_LENGTH equ 12
    80                                 
    81 00000000 55736167653A202E2F-    errUsage db "Usage: ./wheels -sp <septNumber> -cl <septNumber> "
    82 00000000 776865656C73202D73-
    83 00000000 70203C736570744E75-
    84 00000000 6D6265723E202D636C-
    85 00000000 203C736570744E756D-
    86 00000000 6265723E20         
    87 00000032 2D737A203C73657074-     db "-sz <septNumber>"
    88 00000032 4E756D6265723E     
    89 00000042 0A00                    db LF, NULL
    90 00000044 4572726F722C20696E-    errBadCL db "Error, invalid or incomplete command line argument."
    91 00000044 76616C6964206F7220-
    92 00000044 696E636F6D706C6574-
    93 00000044 6520636F6D6D616E64-
    94 00000044 206C696E6520617267-
    95 00000044 756D656E742E       
    96 00000077 0A00                    db LF, NULL
    97                                 
    98 00000079 4572726F722C207370-    errSpdSpec db "Error, speed specifier incorrect."
    99 00000079 656564207370656369-
   100 00000079 6669657220696E636F-
   101 00000079 72726563742E       
   102 0000009A 0A00                    db LF, NULL
   103 0000009C 4572726F722C207370-    errSpdValue db "Error, speed value must be between 1 and 101(7)."
   104 0000009C 6565642076616C7565-
   105 0000009C 206D75737420626520-
   106 0000009C 6265747765656E2031-
   107 0000009C 20616E642031303128-
   108 0000009C 37292E             
   109 000000CC 0A00                    db LF, NULL
   110                                 
   111 000000CE 4572726F722C20636F-    errClrSpec db "Error, color specifier incorrect."
   112 000000CE 6C6F72207370656369-
   113 000000CE 6669657220696E636F-
   114 000000CE 72726563742E       
   115 000000EF 0A00                    db LF, NULL
   116 000000F1 4572726F722C20636F-    errClrValue db "Error, color value must be between 0 and 262414110(7)."
   117 000000F1 6C6F722076616C7565-
   118 000000F1 206D75737420626520-
   119 000000F1 6265747765656E2030-
   120 000000F1 20616E642032363234-
   121 000000F1 31343131302837292E 
   122 00000127 0A00                    db LF, NULL
   123                                 
   124 00000129 4572726F722C207369-    errSizSpec db "Error, size specifier incorrect."
   125 00000129 7A6520737065636966-
   126 00000129 69657220696E636F72-
   127 00000129 726563742E         
   128 00000149 0A00                    db LF, NULL
   129 0000014B 4572726F722C207369-    errSizValue db "Error, size value must be between 202(7) and 5555(7)."
   130 0000014B 7A652076616C756520-
   131 0000014B 6D7573742062652062-
   132 0000014B 65747765656E203230-
   133 0000014B 3228372920616E6420-
   134 0000014B 353535352837292E   
   135 00000180 0A00                    db LF, NULL
   136                                 
   137                                 
   138                                 
   139                                 
   140 00000182 0000000000000000       t dq 0.0
   141 0000018A 0000000000000000       s dq 0.0
   142 00000192 FCA9F1D24D62503F       tStep dq 0.001
   143 0000019A 0000000000000000       sStep dq 0.0
   144 000001A2 0000000000000000       x dq 0
   145 000001AA 0000000000000000       y dq 0
   146 000001B2 00000000004CBD40       scale dq 7500.0
   147                                 
   148 000001BA 0000000000000000       fltZero dq 0.0
   149 000001C2 000000000000F03F       fltOne dq 1.0
   150 000001CA 0000000000000040       fltTwo dq 2.0
   151 000001D2 0000000000000840       fltThree dq 3.0
   152 000001DA 0000000000001040       fltFour dq 4.0
   153 000001E2 0000000000001840       fltSix dq 6.0
   154 000001EA 0000000000000000       fltTwoPiS dq 0.0
   155                                 
   156 000001F2 F4D64354FB210940       pi dq 3.14159265358
   157                                 
   158 000001FA 0000000000000000       fltTmp1 dq 0.0
   159 00000202 0000000000000000       fltTmp2 dq 0.0
   160                                 
   161 0000020A 00000000               red dd 0
   162 0000020E 00000000               green dd 0
   163 00000212 00000000               blue dd 0
   164                                 
   165                                 
   166                                 
   167                                 
   168                                 [section .text]
   169                                 
   170                                 
   171                                 
   172                                 
   173                                 [extern glutInit]
   174                                 %line 137+0 a10procs.asm
   175                                 [extern glutInitDisplayMode]
   176                                 [extern glutInitWindowSize]
   177                                 [extern glutInitWindowPosition]
   178                                 %line 138+1 a10procs.asm
   179                                 [extern glutCreateWindow]
   180                                 %line 138+0 a10procs.asm
   181                                 [extern glutMainLoop]
   182                                 %line 139+1 a10procs.asm
   183                                 [extern glutDisplayFunc]
   184                                 %line 139+0 a10procs.asm
   185                                 [extern glutIdleFunc]
   186                                 [extern glutReshapeFunc]
   187                                 [extern glutKeyboardFunc]
   188                                 %line 140+1 a10procs.asm
   189                                 [extern glutSwapBuffers]
   190                                 %line 140+0 a10procs.asm
   191                                 [extern gluPerspective]
   192                                 [extern glutPostRedisplay]
   193                                 %line 141+1 a10procs.asm
   194                                 [extern glClearColor]
   195                                 %line 141+0 a10procs.asm
   196                                 [extern glClearDepth]
   197                                 [extern glDepthFunc]
   198                                 [extern glEnable]
   199                                 [extern glShadeModel]
   200                                 %line 142+1 a10procs.asm
   201                                 [extern glClear]
   202                                 %line 142+0 a10procs.asm
   203                                 [extern glLoadIdentity]
   204                                 [extern glMatrixMode]
   205                                 [extern glViewport]
   206                                 %line 143+1 a10procs.asm
   207                                 [extern glTranslatef]
   208                                 %line 143+0 a10procs.asm
   209                                 [extern glRotatef]
   210                                 [extern glBegin]
   211                                 [extern glEnd]
   212                                 [extern glVertex3f]
   213                                 [extern glColor3f]
   214                                 %line 144+1 a10procs.asm
   215                                 [extern glVertex2f]
   216                                 %line 144+0 a10procs.asm
   217                                 [extern glVertex2i]
   218                                 [extern glColor3ub]
   219                                 [extern glOrtho]
   220                                 [extern glFlush]
   221                                 [extern glVertex2d]
   222                                 %line 145+1 a10procs.asm
   223                                 
   224                                 [extern cos]
   225                                 %line 146+0 a10procs.asm
   226                                 [extern sin]
   227                                 %line 147+1 a10procs.asm
   228                                 
   229                                 
   230                                 
   231                                 
   232                                 
   233                                 
   234                                 
   235                                 
   236                                 
   237                                 
   238                                 
   239                                 
   240                                 
   241                                 
   242                                 
   243                                 
   244                                 
   245                                 
   246                                 
   247                                 
   248                                 
   249                                 
   250                                 
   251                                 [global getParams]
   252                                 getParams:
   253 00000000 55                     push rbp
   254 00000001 4889E5                 mov rbp, rsp
   255 00000004 4883EC27               sub rsp, 39
   256                                 
   257 00000008 4150                   push r8
   258 0000000A 4151                   push r9
   259 0000000C 4154                   push r12
   260 0000000E 4155                   push r13
   261 00000010 4156                   push r14
   262                                 
   263 00000012 4989FC                 mov r12, rdi
   264 00000015 49C7C500000000         mov r13, 0
   265 0000001C 4989F6                 mov r14, rsi
   266                                 
   267 0000001F 57                     push rdi
   268 00000020 56                     push rsi
   269                                 
   270                                 
   271 00000021 4983FC01               cmp r12, 1
   272 00000025 0F84A3010000           je errUsage_
   273                                 
   274                                 
   275 0000002B 4983FC07               cmp r12, 7
   276 0000002F 0F85A2010000           jne errBadCL_
   277                                 
   278                                 
   279                                 
   280 00000035 4D8B6E08               mov r13, qword[r14 + 8]
   281                                 
   282 00000039 41807D002D             cmp byte[r13], '-'
   283 0000003E 0F859C010000           jne errSpdSpec_
   284 00000044 41807D0173             cmp byte[r13 + 1], 's'
   285 00000049 0F8591010000           jne errSpdSpec_
   286 0000004F 41807D0270             cmp byte[r13 + 2], 'p'
   287 00000054 0F8586010000           jne errSpdSpec_
   288 0000005A 41807D0300             cmp byte[r13 + 3], NULL
   289 0000005F 0F857B010000           jne errSpdSpec_
   290                                 
   291                                 
   292 00000065 48C7C000000000         mov rax, 0
   293 0000006C 49C7C000000000         mov r8, 0
   294 00000073 4C8D4DEF               lea r9, byte[rbp - 17]
   295 00000077 4D8B6E10               mov r13, qword[r14 + 16]
   296                                 
   297                                 arg2Lp:
   298 0000007B 43807C050000           cmp byte[r13 + r8], NULL
   299 00000081 740C                   je arg2Convert
   300 00000083 438A440500             mov al, byte[r13 + r8]
   301 00000088 43880401               mov byte[r9 + r8], al
   302 0000008C 49FFC0                 inc r8
   303 0000008F EBE8                   jmp arg2Lp
   304                                 
   305                                 arg2Convert:
   306                                 
   307                                 
   308                                 
   309                                 
   310                                 
   311 00000091 43C6040100             mov byte[r9 + r8], NULL
   312 00000096 4C89CF                 mov rdi, r9
   313 00000099 4889D6                 mov rsi, rdx
   314                                 
   315 0000009C E835020000             call aSept2int
   316                                 
   317 000000A1 4883F800               cmp rax, FALSE
   318 000000A5 0F8435010000           je errSpdSpec_
   319                                 
   320 000000AB 4883F801               cmp rax, SPD_MIN
   321 000000AF 0F8C34010000           jl errSpdValue_
   322                                 
   323 000000B5 4883F832               cmp rax, SPD_MAX
   324 000000B9 0F8F2A010000           jg errSpdValue_
   325                                 
   326                                 
   327 000000BF 4D8B6E18               mov r13, qword[r14 + 24]
   328                                 
   329 000000C3 41807D002D             cmp byte[r13], '-'
   330 000000C8 0F8524010000           jne errClrSpec_
   331 000000CE 41807D0163             cmp byte[r13 + 1], 'c'
   332 000000D3 0F8519010000           jne errClrSpec_
   333 000000D9 41807D026C             cmp byte[r13 + 2], 'l'
   334 000000DE 0F850E010000           jne errClrSpec_
   335 000000E4 41807D0300             cmp byte[r13 + 3], NULL
   336 000000E9 0F8503010000           jne errClrSpec_
   337                                 
   338                                 
   339 000000EF 48C7C000000000         mov rax, 0
   340 000000F6 49C7C000000000         mov r8, 0
   341 000000FD 4C8D4DE4               lea r9, byte[rbp - 28]
   342 00000101 4D8B6E20               mov r13, qword[r14 + 32]
   343                                 
   344                                 arg4Lp:
   345 00000105 43807C050000           cmp byte[r13 + r8], NULL
   346 0000010B 740C                   je arg4Convert
   347 0000010D 438A440500             mov al, byte[r13 + r8]
   348 00000112 43880401               mov byte[r9 + r8], al
   349 00000116 49FFC0                 inc r8
   350 00000119 EBE8                   jmp arg4Lp
   351                                 
   352                                 arg4Convert:
   353                                 
   354                                 
   355                                 
   356                                 
   357                                 
   358 0000011B 43C6040100             mov byte[r9 + r8], NULL
   359 00000120 4C89CF                 mov rdi, r9
   360 00000123 4889D6                 mov rsi, rdx
   361                                 
   362 00000126 E8AB010000             call aSept2int
   363                                 
   364 0000012B 4883F800               cmp rax, FALSE
   365 0000012F 0F84BD000000           je errClrSpec_
   366                                 
   367 00000135 4883F800               cmp rax, CLR_MIN
   368 00000139 0F8CBC000000           jl errClrValue_
   369                                 
   370 0000013F 483DFFFFFF00           cmp rax, CLR_MAX
   371 00000145 0F8FB0000000           jg errClrValue_
   372                                 
   373                                 
   374                                 
   375 0000014B 4D8B6E28               mov r13, qword[r14 + 40]
   376                                 
   377 0000014F 41807D002D             cmp byte[r13], '-'
   378 00000154 0F85AA000000           jne errSizSpec_
   379 0000015A 41807D0173             cmp byte[r13 + 1], 's'
   380 0000015F 0F859F000000           jne errSizSpec_
   381 00000165 41807D027A             cmp byte[r13 + 2], 'z'
   382 0000016A 0F8594000000           jne errSizSpec_
   383 00000170 41807D0300             cmp byte[r13 + 3], NULL
   384 00000175 0F8589000000           jne errSizSpec_
   385                                 
   386                                 
   387 0000017B 48C7C000000000         mov rax, 0
   388 00000182 49C7C000000000         mov r8, 0
   389 00000189 4C8D4DD9               lea r9, byte[rbp - 39]
   390 0000018D 4D8B6E30               mov r13, qword[r14 + 48]
   391                                 
   392                                 arg6Lp:
   393 00000191 43807C050000           cmp byte[r13 + r8], NULL
   394 00000197 740C                   je arg6Convert
   395 00000199 438A440500             mov al, byte[r13 + r8]
   396 0000019E 43880401               mov byte[r9 + r8], al
   397 000001A2 49FFC0                 inc r8
   398 000001A5 EBE8                   jmp arg6Lp
   399                                 
   400                                 arg6Convert:
   401                                 
   402                                 
   403                                 
   404                                 
   405                                 
   406 000001A7 43C6040100             mov byte[r9 + r8], NULL
   407 000001AC 4C89CF                 mov rdi, r9
   408 000001AF 4889D6                 mov rsi, rdx
   409                                 
   410 000001B2 E81F010000             call aSept2int
   411                                 
   412 000001B7 4883F800               cmp rax, FALSE
   413 000001BB 744B                   je errSizSpec_
   414                                 
   415 000001BD 4883F864               cmp rax, SIZ_MIN
   416 000001C1 7C4E                   jl errSizValue_
   417                                 
   418 000001C3 483DD0070000           cmp rax, SIZ_MAX
   419 000001C9 7F46                   jg errSizValue_
   420                                 
   421 000001CB 48C7C001000000         mov rax, TRUE
   422 000001D2 EB52                   jmp doneSuccess
   423                                 
   424                                 
   425                                 errUsage_:
   426 000001D4 48C7C7[00000000]       mov rdi, errUsage
   427 000001DB EB3D                   jmp doneError
   428                                 
   429                                 errBadCL_:
   430 000001DD 48C7C7[00000000]       mov rdi, errBadCL
   431 000001E4 EB34                   jmp doneError
   432                                 
   433                                 errSpdSpec_:
   434 000001E6 48C7C7[00000000]       mov rdi, errSpdSpec
   435 000001ED EB2B                   jmp doneError
   436                                 
   437                                 errSpdValue_:
   438 000001EF 48C7C7[00000000]       mov rdi, errSpdValue
   439 000001F6 EB22                   jmp doneError
   440                                 
   441                                 errClrSpec_:
   442 000001F8 48C7C7[00000000]       mov rdi, errClrSpec
   443 000001FF EB19                   jmp doneError
   444                                 
   445                                 errClrValue_:
   446 00000201 48C7C7[00000000]       mov rdi, errClrValue
   447 00000208 EB10                   jmp doneError
   448                                 
   449                                 errSizSpec_:
   450 0000020A 48C7C7[00000000]       mov rdi, errSizSpec
   451 00000211 EB07                   jmp doneError
   452                                 
   453                                 errSizValue_:
   454 00000213 48C7C7[00000000]       mov rdi, errSizValue
   455 0000021A EBFE                   jmp doneError
   456                                 
   457                                 doneError:
   458 0000021C E882000000             call printString
   459 00000221 48C7C000000000         mov rax, FALSE
   460                                 
   461                                 doneSuccess:
   462 00000228 5E                     pop rsi
   463 00000229 5F                     pop rdi
   464 0000022A 415E                   pop r14
   465 0000022C 415D                   pop r13
   466 0000022E 415C                   pop r12
   467 00000230 4159                   pop r9
   468 00000232 4158                   pop r8
   469                                 
   470 00000234 4889EC                 mov rsp, rbp
   471 00000237 5D                     pop rbp
   472                                 
   473 00000238 C3                     ret
   474                                 
   475                                 
   476                                 
   477                                 
   478                                 
   479                                 
   480                                 
   481                                 
   482                                 
   483                                 
   484                                 
   485                                 
   486                                 
   487                                 
   488                                 
   489                                 [common speed 1:4]
   490                                 [common color 1:4]
   491                                 [common size 1:4]
   492                                 
   493                                 [global drawWheels]
   494                                 drawWheels:
   495 00000239 55                      push rbp
   496                                 
   497                                 
   498                                 
   499                                 
   500                                 
   501                                 
   502                                 
   503                                 
   504                                 
   505                                 
   506                                 
   507                                 
   508                                 
   509 0000023A 48C7C700400000          mov rdi, GL_COLOR_BUFFER_BIT
   510 00000241 E8(F6FFFFFF)            call glClear
   511                                 
   512                                 
   513 00000246 48C7C700000000          mov rdi, GL_POINTS
   514 0000024D E8(F6FFFFFF)            call glBegin
   515                                 
   516                                 
   517                                 
   518                                 
   519                                 
   520                                 
   521                                 
   522                                 
   523                                 
   524                                 
   525                                 
   526                                 
   527                                 
   528                                 
   529                                 
   530                                 
   531                                 
   532                                 
   533                                 
   534 00000252 E8(F6FFFFFF)            call glEnd
   535 00000257 E8(F6FFFFFF)            call glFlush
   536                                 
   537                                 
   538                                 
   539                                 
   540                                 
   541                                 
   542 0000025C F20F100425[00000000]      movsd xmm0, qword [s]
   543 00000265 F20F580425[00000000]      addsd xmm0, qword [sStep]
   544 0000026E F20F110425[00000000]      movsd qword [s], xmm0
   545                                 
   546 00000277 F20F100425[00000000]      movsd xmm0, qword [s]
   547 00000280 F20F100C25[00000000]      movsd xmm1, qword [fltOne]
   548 00000289 660F2EC1                ucomisd xmm0, xmm1
   549 0000028D 7610                    jbe resetDone
   550                                 
   551 0000028F F20F100425[00000000]      movsd xmm0, qword [fltZero]
   552 00000298 F20F110425[00000000]      movsd qword [sStep], xmm0
   553                                 resetDone:
   554                                 
   555 000002A1 E8(F6FFFFFF)            call glutPostRedisplay
   556                                 
   557                                 
   558                                 
   559 000002A6 5D                      pop rbp
   560 000002A7 C3                      ret
   561                                 
   562                                 
   563                                 
   564                                 
   565                                 
   566                                 
   567                                 
   568                                 
   569                                 
   570                                 
   571                                 
   572                                 
   573                                 
   574                                 [global printString]
   575                                 printString:
   576 000002A8 53                      push rbx
   577                                 
   578                                 
   579                                 
   580                                 
   581 000002A9 4889FB                  mov rbx, rdi
   582 000002AC 48C7C200000000          mov rdx, 0
   583                                 strCountLoop:
   584 000002B3 803B00                  cmp byte [rbx], NULL
   585 000002B6 7406                    je strCountDone
   586 000002B8 48FFC3                  inc rbx
   587 000002BB 48FFC2                  inc rdx
   588 000002BE EBF1                    jmp strCountLoop
   589                                 strCountDone:
   590                                 
   591 000002C0 4883FA00                cmp rdx, 0
   592 000002C4 7411                    je prtDone
   593                                 
   594                                 
   595                                 
   596                                 
   597 000002C6 48C7C001000000          mov rax, SYS_write
   598 000002CD 4889FE                  mov rsi, rdi
   599 000002D0 48C7C701000000          mov rdi, STDOUT
   600                                 
   601 000002D7 0F05                    syscall
   602                                 
   603                                 
   604                                 
   605                                 
   606                                 prtDone:
   607 000002D9 5B                      pop rbx
   608 000002DA C3                      ret
   609                                 
   610                                 
   611                                 
   612                                 [global aSept2int]
   613                                 aSept2int:
   614                                 
   615 000002DB 53                     push rbx
   616 000002DC 51                     push rcx
   617 000002DD 52                     push rdx
   618 000002DE 4154                   push r12
   619 000002E0 4155                   push r13
   620 000002E2 4156                   push r14
   621                                 
   622 000002E4 49C7C200000000         mov r10, 0
   623 000002EB 49C7C600000000         mov r14, 0
   624 000002F2 48C7C000000000         mov rax, 0
   625                                 
   626 000002F9 EB07                   jmp checkLength
   627                                 
   628                                 spaces:
   629 000002FB 4883F800               cmp rax, 0
   630 000002FF 754E                   jne convFail
   631 00000301 49FFC2                 inc r10
   632                                 
   633                                 checkLength:
   634 00000304 49C7C300000000         mov r11, 0
   635 0000030B 4983FE32               cmp r14, 50
   636 0000030F 743E                   je convFail
   637                                 
   638 00000311 468A1C17               mov r11b, byte[rdi + r10]
   639 00000315 48C7C207000000         mov rdx, 7
   640 0000031C 4180FB00               cmp r11b, NULL
   641 00000320 7434                   je convEnd
   642                                 
   643                                 conv2Int:
   644 00000322 4180FB20               cmp r11b, ' '
   645 00000326 74D1                   je spaces
   646 00000328 4180EB30               sub r11b, '0'
   647 0000032C 4180FB00               cmp r11b, 0
   648 00000330 7C1D                   jl convFail
   649 00000332 4180FB07               cmp r11b, 7
   650 00000336 7F17                   jg convFail
   651 00000338 48F7E2                 mul rdx
   652 0000033B 4400D8                 add al, r11b
   653 0000033E 49FFC6                 inc r14
   654 00000341 49FFC2                 inc r10
   655 00000344 EBBC                   jmp checkLength
   656                                 
   657                                 convSuccess:
   658 00000346 8906                   mov dword[rsi], eax
   659 00000348 48C7C001000000         mov rax, TRUE
   660 0000034F EB05                   jmp convEnd
   661                                 
   662                                 convFail:
   663 00000351 48C7C000000000         mov rax, FALSE
   664                                 
   665                                 convEnd:
   666 00000358 415E                   pop r14
   667 0000035A 415D                   pop r13
   668 0000035C 415C                   pop r12
   669 0000035E 5A                     pop rdx
   670 0000035F 59                     pop rcx
   671 00000360 5B                     pop rbx
   672                                 
   673 00000361 C3                     ret
